(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{435:function(s,e,a){"use strict";a.r(e);var t=a(43),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"redis-过期删除策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-过期删除策略"}},[s._v("#")]),s._v(" Redis 过期删除策略")]),s._v(" "),a("h2",{attrs:{id:"源码分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码分析"}},[s._v("#")]),s._v(" 源码分析")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// redis.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置serverCron任务每秒检测几次")]),s._v("\nhz "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),a("p",[a("strong",[s._v("Redis的过期删除策略有两种，一种被动删除，一种主动删除。")])]),s._v(" "),a("p",[a("strong",[s._v("key过期信息存储为绝对的Unix时间戳（ms），这代表Redis的过期策略，对宿主机器时间的稳定性有强要求。")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("当有客户端访问一个key时，Redis会检测这个key是否过期，如果过期，会删除这个key。")])]),s._v(" "),a("li",[a("p",[s._v('CPU空闲时，执行serverCron定时任务，执行周期为每秒10次（可通过修改配置属性"hz"来修改执行周期），任务分为以下几个步骤：')]),s._v(" "),a("ol",[a("li",[s._v("每次过期清理时间不超过CPU时间的25%，")]),s._v(" "),a("li",[s._v("随机选择20个key，判断它们是否过期，如果过期，则删除，")]),s._v(" "),a("li",[s._v("如果发现一次选择中，有超过25%（默认情况下就是5个）的key都过期了，则重复步骤2，直到随机选择中，过期的key百分比低于25%。")])])])]),s._v(" "),a("h3",{attrs:{id:"副本和aof文件的过期key处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#副本和aof文件的过期key处理"}},[s._v("#")]),s._v(" 副本和aof文件的过期key处理")]),s._v(" "),a("p",[s._v("当Redis判断一组key过期后，就会对这些key同时执行del命令。")]),s._v(" "),a("p",[s._v("这样的话，过期删除的操作就集中在master实例上，aof文件和副本只需要添加和执行同步过来的命令即可。")]),s._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// expire.c")]),s._v("\n")])])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")])])}),[],!1,null,null,null);e.default=r.exports}}]);