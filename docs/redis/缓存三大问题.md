# 缓存三大问题

## 缓存击穿

**当许多请求在访问同一个key时，这个key失效了，导致大量请求打到数据库上。**

### 问题

数据库的访问量突增，压力变大，可能会导致数据库宕机。

### 解决方案

加锁，当缓存的key为空时，对第一个到数据查询的线程加锁，把其他线程拦在后边，当第一个线程查询到数据，然后重建缓存后，其他线程就可以直接从缓存中获取数据。

## 缓存穿透

**查询不存在的数据，比如说，缓存和数据库中都没有查询key，导致每次都要到数据库中查询。**

### 问题

如果有黑客使用不存在的key对系统进行访问，就会导致全部的请求打到数据库上，数据库的访问量突增，压力变大，可能会导致数据库宕机。

### 解决方案

1. 缓存null值
2. BloomFilter

## 缓存雪崩

**在某一时刻，大量和缓存失效，导致原本应该访问缓存的请求全部打在数据库上。**

### 问题

大量缓存失效，导致全部的请求打到数据库上，数据库的访问量突增，压力变大，可能会导致数据库宕机。

### 解决方案

### 热点key集中失效（缓存雪崩的变种）

### 解决方案

给不同的key设置不同的缓存时间，比如说，在固定时间上再加一个随机值。

## 缓存和数据库的双写一致性

### 问题

### 解决方案

## 延伸问题

* 大key是如何产生的，多大算大key

* 热key产生的原因及解决方案